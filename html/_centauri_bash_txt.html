<!DOCTYPE html>
<html><head><meta charset='UTF-8'></meta>
<title>centaurihelp ─ _centauri_bash_txt</title>
<link rel='stylesheet' type='text/css' href='default.css'></link>
<script type='text/javascript' src='default.js'></script>
</head><body onload='initialize("_centauri_bash_txt")'><article id='top'>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_tra.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='content.html#top'>[Content]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_use.html'>[next &gt;&gt;]</a></div>
</div></nav>
<section id='section-1'>
<div id='_centauri_bash_txt' class='item-module'>
<span>Module</span><span> - </span><span>_centauri_bash_txt</span><span> - </span><span><a href="index.html">centauri-bash-lib</a>: Text tools (grep, sort)</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'>. <b>_centauri_bash_txt</b></div>
</div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>Four of the functions in this module internally share the same logic, as they transform an input array to an output array. The input array can be passed by the caller, generated from arguments or from stdin (useful to read files). The output array can be passed to the caller, converted to a return string or written to stdout (useful to write files):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  • <a href="#txtsort">txtsort()</a> - Simple internal sort of text lines
  • <a href="#extsort">extsort()</a> - Run external sort/uniq to sort lines of text
  • <a href="#txtgrep">txtgrep()</a> - Lightweight internal text filter (like grep)
  • <a href="#extgrep">extgrep()</a> - Extended text filter (using external grep)</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The functions extsort and extgrep will load the <a href="_centauri_bash_pip.html">_centauri_bash_pip</a> module (on demand) to run the external command via <a href="_centauri_bash_pip.html#syspipe">syspipe()</a>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-text'><pre># sort argument list to array
txtsort <b>-a</b> data <b>--</b> Franziska Johan John Marc Mary</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># grep an array to a file (via stdout redirection)
txtgrep <b>-i</b> data <b>-s</b> - <b>-x</b> <b>&quot;^([A-M]|[a-m])&quot;</b> &gt; <b>&quot;$my_file&quot;</b></pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>Copyright Dr. J. Pfennig (c) 2021-2022</div>
</div>
</section>
<section id='section-2'>
<div id='txtsort' class='item-function'>
<span>Function</span><span> - </span><span>txtsort</span><span> - </span><span>Simple internal sort of text lines</span></div>
<div class='def-row'>
<div class='def-label'>Calls:</div>
<div class='def-text'>(1) <b>txtsort</b> [<b>-a</b>|<b>-s</b> <i>var</i>] [<b>-m</b> <i>max</i>] [<b>-n</b>] [<b>-r</b>] [<b>-f</b>|<b>-q</b>] <b>-i</b> <i>var</i>
(2) <b>txtsort</b> [<b>-a</b>|<b>-s</b> <i>var</i>] [<b>-m</b> <i>max</i>] [<b>-n</b>] [<b>-r</b>] [<b>-f</b>|<b>-q</b>] [<b>--</b>] <i>line</i>...</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-a</b>  save result to array <i>var</i>
<b>-f</b>  make errors fatal
<b>-i</b>  input from <i>var</i> (<b>-</b> for stdin), can be array or string
<b>-m</b>  max input lines, use <a href="#extsort">extsort()</a> for more input
<b>-n</b>  perform a numerical sort (default is lexical)
<b>-q</b>  do not report errors
<b>-r</b>  reverse sort order
<b>-s</b>  save result to <i>var</i> (<b>-</b> for stdout)</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>var</i>   name of a string variable or array
<i>max</i>   line count threshold (default 15)
<i>line</i>  text line to be sorted</div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> at success or <b>false</b> otherwise.</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'>In-place (same input/output array) numberic sort</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>local data=(343 332 22)
<b>txtsort</b> <b>-n</b> <b>-a</b> _data <b>-i</b> _data</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>This function runs a simple bubble sort unless the line count threshold gets exceeded. In the later case <a href="#extsort">extsort()</a> is invoked. The rationale is to prevent forking an external sort programm for trival cases.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>On a numerical sort only the leading digits are used as key, empty keys are treated as zero and the resulting order of non-numeric items is undefined.</div>
</div>
</section>
<section id='section-3'>
<div id='extsort' class='item-function'>
<span>Function</span><span> - </span><span>extsort</span><span> - </span><span>Run external sort/uniq to sort lines of text</span></div>
<div class='def-row'>
<div class='def-label'>Calls:</div>
<div class='def-text'>(1) <b>extsort</b> [<b>-a</b>|<b>-s</b> <i>var</i>] <b>-i</b> <i>var</i> [<b>-o</b> <i>opt</i>] [<b>-r</b>] [<b>-u</b>] [<b>-f</b>|<b>-q</b>]
(2) <b>extsort</b> [<b>-a</b>|<b>-s</b> <i>var</i>] [<b>-o</b> <i>opt</i>] [<b>-r</b>] [<b>-u</b>] [<b>-f</b>|<b>-q</b>] [<b>--</b>] <i>line</i>...</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-a</b>  save result to array <i>var</i>
<b>-f</b>  make errors fatal
<b>-i</b>  input from <i>var</i> (<b>-</b> for stdin), can be array or string
<b>-o</b>  pass <i>opt</i> as option string to <b>/usr/bin/sort</b>
<b>-q</b>  do not report errors
<b>-r</b>  reverse sort order
<b>-s</b>  save result to <i>var</i> (or use <b>&quot;-s -&quot;</b> for stdout)
<b>-u</b>  pass sort result trough <b>/usr/bin/uniq</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>var</i>   name of a variable or array
<i>opt</i>   option string (example <b>&quot;-k2 --ignore-case&quot;</b>)
<i>line</i>  text line to be sorted</div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-text'><pre><b>extsort</b> <b>-a</b> dout <b>-i</b> -      # sort stdin, output to array
<b>extsort</b> <b>-s</b> dout <b>-i</b> dinp   # sort array, output to string
<b>extsort</b> <b>-a</b> dout <b>--</b> <b>&quot;$@&quot;</b>   # sort arguments, output to array</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> at success or <b>false</b> otherwise.</div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>The function runs the <b>/usr/bin/sort</b> and <b>/usr/bin/uniq</b> utilities by calling <a href="_centauri_bash_pip.html#syspipe">syspipe()</a>.</div>
</div>
</section>
<section id='section-4'>
<div id='txtgrep' class='item-function'>
<span>Function</span><span> - </span><span>txtgrep</span><span> - </span><span>Lightweight internal text filter (like grep)</span></div>
<div class='def-row'>
<div class='def-label'>Calls:</div>
<div class='def-text'>(1) <b>txtgrep</b> [<b>-a</b>|<b>-s</b> <i>var</i>] <b>-i</b> <i>var</i> [<b>-m</b>] [<b>-n</b>] <b>-x</b>|<b>-y</b> <i>expr</i>
(2) <b>txtgrep</b> [<b>-a</b>|<b>-s</b> <i>var</i>] [<b>-m</b>] [<b>-n</b>] <b>-x</b>|<b>-y</b> <i>expr</i> [<b>--</b>] <i>line</i>...</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-a</b>  save result to array <i>var</i>
<b>-i</b>  input from <i>var</i> (<b>-</b> for stdin), can be array or string
<b>-m</b>  stop after 1st match
<b>-n</b>  invert condition
<b>-s</b>  save result to <i>var</i> (<b>-</b> for stdout)
<b>-x</b>  use regular expression
<b>-y</b>  use bash glob pattern</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>var</i>   name of a variable or array
<i>expr</i>  regular expression -or- bash glob pattern
<i>line</i>  text line to be sorted</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'><pre><b>txtgrep</b> <b>-n</b> <b>-y</b> <b>&quot;#*&quot;</b> <b>-a</b> data <b>-i</b> - &lt;file.txt</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-block'>Without option <b>-a</b> or <b>-s</b> status <b>true</b> is returned after the 1st match and <b>false</b> if no match is found (this implies option <b>-m</b>).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>With option <b>-a</b> -or <b>-s</b> are used always <b>true</b> is returned.</div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>The function works on text, line by line. Bash regular expressions can be slow. For larger amounts of data <a href="#extgrep">extgrep()</a> may perform better.</div>
</div>
</section>
<section id='section-5'>
<div id='extgrep' class='item-function'>
<span>Function</span><span> - </span><span>extgrep</span><span> - </span><span>Extended text filter (using external grep)</span></div>
<div class='def-row'>
<div class='def-label'>Calls:</div>
<div class='def-text'>(1) <b>extgrep</b> [<b>-a</b>|<b>-s</b> <i>var</i>] <b>-i</b> <i>var</i> [<b>-o</b> <i>opt</i>] [<b>-r</b>] [<b>-f</b>|<b>-q</b>]
(2) <b>extgrep</b> [<b>-a</b>|<b>-s</b> <i>var</i>] [<b>-o</b> <i>opt</i>] [<b>-r</b>] [<b>-f</b>|<b>-q</b>] [<b>--</b>] <i>line</i>...</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-a</b>  save result to array <i>var</i>
<b>-f</b>  make errors fatal
<b>-i</b>  input from <i>var</i> (<b>-</b> for stdin), can be array or string
<b>-l</b>  return line numbers             (grep <b>-n</b>
<b>-m</b>  stop after 1st match            (grep <b>-q</b>)
<b>-n</b>  invert condition                (grep <b>-v</b>)
<b>-o</b>  append <i>opt</i> verbatim to the grep command
<b>-q</b>  do not report errors
<b>-s</b>  save result to <i>var</i> (<b>-</b> for stdout)
<b>-u</b>  case independent matching       (grep <b>-i</b>)
<b>-x</b>  extended regular expression     (grep <b>-E</b>)
<b>-y</b>  basic reqular expression</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Using <b>-l</b>|<b>-m</b>|<b>-u</b>|<b>-x</b> adds the corresponding grep options to the command. <b>-x</b>|<b>-y</b> add grep&apos;s <b>-e &quot;&lt;pattern&gt;&quot;</b>. The argument of <b>-o</b> is finally appended to the generated command.</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>var</i>   name of a variable or array
<i>opt</i>   additional options for grep
<i>line</i>  text line to be filtered</div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-text'><pre><b>extgrep</b> <b>-x</b> <b>&quot;[Hh]ello&quot;</b> <b>-a</b> dout <b>-i</b> -      # from stdin, to array
<b>extgrep</b> <b>-y</b> <b>&quot;[Hh]ello&quot;</b> <b>-s</b> dout <b>-i</b> dinp   # from array, to string
<b>extgrep</b> <b>-o</b> <b>&quot;[Hh]ello&quot;</b> <b>-a</b> dout <b>--</b> <b>&quot;$@&quot;</b>   # from arguments, to array</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> at success or <b>false</b> otherwise.</div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>Please don&apos;t get confused, the function options are not the same as grep options. See this function as something that is as easy to use as <a href="#txtgrep">txtgrep()</a> but can handle large amounts of data faster and that has more features by using the <b>/usr/bin/grep</b> utility. It is possible to pass grep options verbatim using <b>&quot;-o&quot;</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>To run <b>/usr/bin/grep</b>, an external process must be started and the data must be copied between the script and the external process. In many cases the internal <a href="#txtgrep">txtgrep()</a> may be faster. The function uses <a href="_centauri_bash_pip.html#syspipe">syspipe()</a> to run grep.</div>
</div>
</section>
<section id='section-6'>
<div id='txtfold' class='item-function'>
<span>Function</span><span> - </span><span>txtfold</span><span> - </span><span>folding of long text lines, fetch limited text size</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>txtfold</b> [<b>-d</b> <i>deli</i>] [<b>-f</b> <i>fixl</i>] <b>-m</b> <i>maxi</i> <b>-s</b> <i>vout</i> [<b>--</b>] <i>vinp</i></div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-d</b>  delimiter for joining multiple output lines
<b>-f</b>  fixup function to increase <i>maxi</i> for markup sequences
<b>-m</b>  maximum characters to fetch
<b>-s</b>  save result into this variable</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>maxi</i>  maximum number of characters to return
<i>deli</i>  a delimiter string (use - for newline)
<i>vinp</i>  variable holding input
<i>vout</i>  variable to receice the output</div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> if text is returned, <b>false</b> if no input is left</div>
</div>
<div class='def-row'>
<div class='def-label'>Markup:</div>
<div class='def-block'>If a text contains markup like &quot;one **two** tree&quot; a fixup routine can be used to increase <i>maxi</i>. In the example case 4 would be added to <i>vmax</i>:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>Call: <i>fixl</i> <i>vout</i> <i>vmax</i>            # 2 variable name arguments</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The fixup routine may also update <i>vout</i> if it fixes <i>vmax</i> correctly.</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'>(1) simple line folding into a buffer<pre>local data=<b>&quot;$*&quot;</b> text
<b>txtfold</b> <b>-m</b> 70 <b>-d</b> - <b>-s</b> text <b>--</b> data</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>(2) fetch limited size and iterate over input<pre>local data=<b>&quot;$*&quot;</b> line
while <b>txtfold</b> <b>-m</b> 70 <b>-s</b> line <b>--</b> data ; do
    message <b>-a</b> <b>--</b> <b>&quot;$line&quot;</b>
done</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>This function removes the returned text from the input variable. The result has simplified whitespace and is trimmed.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'><b>txtfold</b> is not very fast (roughly 500µs per 80 char line) but for modest sizes the time scales almost linear with the input size.</div>
</div>
</section>
</article>
<div class='def-break'></div>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_tra.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='#top'>[Top of Page]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_use.html'>[next &gt;&gt;]</a></div>
</div></nav>
</body></html>
