<!DOCTYPE html>
<html><head><meta charset='UTF-8'></meta>
<title>centaurihelp â”€ _centauri_bash_mnt</title>
<link rel='stylesheet' type='text/css' href='default.css'></link>
<script type='text/javascript' src='default.js'></script>
</head><body onload='initialize("_centauri_bash_mnt")'><article id='top'>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_lib.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='content.html#top'>[Content]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_pip.html'>[next &gt;&gt;]</a></div>
</div></nav>
<section id='section-1'>
<div id='_centauri_bash_mnt' class='item-module'>
<span>Module</span><span> - </span><span>_centauri_bash_mnt</span><span> - </span><span><a href="index.html">centauri-bash-lib</a>: Storage device mount support</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'>. <b>_centauri_bash_mnt</b> [<b>-d</b>|<b>-m</b>]</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-d</b>  add command line option: <b>-c</b> <b>--device</b>  automount disk
<b>-m</b>  add command line option: <b>-m</b> <b>--mount</b>   automount storage</div>
</div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-text'>When loaded explicitly the module can add command line options
to a script, see module options above. The module options <b>-c</b> and
<b>-m</b> provide the same functionality but add different command line
options.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>Automounting a disk or storage is handled by <a href="#automount">automount()</a>. On
<a href="_centauri_bash_lib.html#quit">quit()</a> an automounted disk or storage will be unmounted.</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'>Add command line option <b>--mount</b> for automount (and unmount):<pre>. <b>_centauri_bash_mnt</b> <b>-m</b></pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>Copyright Dr. J. Pfennig (c) 2020-2022</div>
</div>
</section>
<section id='section-2'>
<div id='automount' class='item-function'>
<span>Function</span><span> - </span><span>automount</span><span> - </span><span>Automatic volume mount and unmount</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>automount</b> [<b>-k</b> <i>kind</i>] [<b>-o</b> <i>func</i>] [<b>-r</b>] [<b>-m</b>] [<b>-w</b>] <i>label</i>|<i>device</i>
          [<b>-k</b> <i>kind</i>] [<b>-o</b> <i>func</i>] [<b>-r</b>] [<b>-c</b>] [<b>-u</b>] <i>label</i>|<i>device</i>
<b>automount</b> [<b>-o</b> <i>func</i>] <b>-q</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-c</b>  check for <b>automount</b> (can be combined with <b>-u</b>)
<b>-k</b>  kind of device for output                      (default: device)
<b>-m</b>  do not register for automatic unmount
<b>-o</b>  output function: trace|message|quiet|progress  (default: auto)
<b>-q</b>  umount all automounts
<b>-r</b>  register for unmount (but do not mount)
<b>-u</b>  unmount now (see <b>-c</b> option)
<b>-w</b>  wait for device (before mount)</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>kind</i>    describes device in messages (default: storage)
<i>func</i>    function called for output or progress reporting
<i>label</i>   fs label to be matched
<i>device</i>  device name to be matched</div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> on success, see <a href="#findmount">findmount()</a> for the <b>CEN_MOUNT_</b>xxx variables
that are set.</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'>Automount a USB stick partition with label &apos;buster_vol0&apos;:<pre><b>automount</b> <b>-k</b> <b>&quot;USB stick&quot;</b> <b>-o</b> progress <b>-w</b> <b>&quot;buster_vol0&quot;</b></pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>It is recommended to use the <b>CEN_HOOK_QUIT</b> hook for automatic unmounting, which is the default (see <b>-r</b> option).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The <a href="#findmount">findmount()</a> function is used to check if a device is already mounted. In this case it will not be mounted again and it will not be unmonted via <a href="_centauri_bash_lib.html#quit">quit()</a>. After a successfull mount <a href="#findmount">findmount()</a> is called again to set some <b>CEN_MOUNT_</b>xxx variables.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The functions uses <b>/usr/bin/udisksctl</b> for mounting, which does not need root priviledges but does not allow to pass most mount options.</div>
</div>
</section>
<section id='section-3'>
<div id='blkdevice' class='item-function'>
<span>Function</span><span> - </span><span>blkdevice</span><span> - </span><span>block device and mount status checker</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>blkdevice</b> [<b>-a</b> <i>rslt</i>] [<b>-e</b>|<b>-f</b>] [<b>-s</b>] [<b>-d</b>] [<b>-i</b>] [<b>-p</b>] [<b>-m</b>] <i>item</i>
<b>blkdevice</b> [<b>-a</b> <i>rslt</i>] [<b>-e</b>|<b>-f</b>] [<b>-s</b>] [<b>-i</b>] [<b>-p</b>] [<b>-m</b>] <b>-n</b> <i>part</i> <i>item</i></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>The function checks if a device is a block device, a partition exists
and if a device or a partition is mounted. It finds mount points and
can generate a valid path name for a partition.</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-a</b>  result array to be used (default: <b>CEN_BLKDEVICE</b>)
<b>-d</b>  allow a block device    (default: <b>-d</b> <b>-i</b> <b>-p</b>)
<b>-e</b>  generate error messages
<b>-f</b>  generate fatal errors
<b>-i</b>  allow an image file     (default: <b>-d</b> <b>-i</b> <b>-p</b>)
<b>-m</b>  allow device to be mounted
<b>-n</b>  partition number to generate a partition name
<b>-p</b>  allow a partition       (default: <b>-d</b> <b>-i</b> <b>-p</b>)
<b>-s</b>  silent, no trace messages</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>item</i>      name or path of a block device or an image
<i>part</i>      a partion number
<i>rslt</i>      result array name</div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> on success, <b>false</b> on error, sets result array</div>
</div>
<div class='def-row'>
<div class='def-label'>Variables:</div>
<div class='def-text'>always fills the result array (error/unused default values are &apos;-&apos;):
[0] device file path
[1] partition file path -or- empty string
[2] partition number    -or- <b>0</b>
[3] mountpoint</div>
</div>
</section>
<section id='section-4'>
<div id='findmount' class='item-function'>
<span>Function</span><span> - </span><span>findmount</span><span> - </span><span>Find device or mountpoint or get a list of mounts</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>findmount</b> [<b>-d</b>] <i>device</i>|<i>mountpoint</i>                # searches ...
<b>findmount</b> [<b>-d</b>] <i>device</i>|- [<i>mountpoint</i>|<b>-</b>]
<b>findmount</b> [<b>-d</b>] <i>type</i> <i>mountpoint</i>
<b>findmount</b> [<b>-c</b>] [<b>-d</b>] <b>-l</b> <i>label</i>
<b>findmount</b> <b>-r</b> <i>kind</i> <i>device</i>
<b>findmount</b> <b>-t</b> <i>type</i> [<b>-t</b> <i>type</i>]...                  # lists ...
<b>findmount</b> <b>-a</b> [<b>-t</b> <i>type</i>]...</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-a</b>  get all (real) mount infos into <b>CEN_MOUNT_ARR</b>
<b>-c</b>  also try upper/lower case label
<b>-d</b>  return <b>true</b> if device is found but not mounted
<b>-l</b>  find by label
<b>-r</b>  get identifier for device into <b>CEN_MNT_DIR</b>
<b>-t</b>  find by type (returns <b>CEN_MOUNT_ARR</b> array)</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>device</i>     device to find, example &apos;/dev/sdc1&apos;
<i>mountpoint</i> mount location, example &apos;/mnt/xxx&apos;
<i>label</i>      partition label to find
<i>kind</i>       type of identifier: label, partlabel, uuid, partuuid
<i>type</i>       filesystem type to find (returns array). Use &apos;+&apos; to
           get all types and &apos;-&apos; for types not in <b>CEN_MOUNT_EXC</b>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-text'><b>true</b> at success or <b>false</b> otherwise. Also some variables are set.</div>
</div>
<div class='def-row'>
<div class='def-label'>Variables:</div>
<div class='def-text'>The following variables are set if option <b>-a</b> or <b>-t</b> are not used:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_MOUNT_DEV</b>  -  device path
<b>CEN_MOUNT_DIR</b>  -  mount dir
<b>CEN_MOUNT_LBL</b>  -  mount label
<b>CEN_MOUNT_FS</b>   -  fs type</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>With option <b>-a</b> or <b>-t</b> an array is returned:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_MOUNT_ARR</b>  -  without option <b>-a</b> only the device paths of mounts matching
                  the types are returned. With <b>-a</b> option all <b>&quot;/proc/mounts&quot;</b>
                  fields are returned, separated by tabulators.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_MOUNT_EXC</b>  -  a predifened list of exclusion used with <b>-t</b> &apos;-&apos;.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>In <b>&quot;/proc/mounts&quot;</b> the mount dir might contain escapes. The returned value is
always unescaped by this function; path names with tabulator chars won&apos;t work.</div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-text'><pre># find mounted network filesystems by type
<b>findmount</b> <b>-t</b> cifs <b>-t</b> nfs <b>-t</b> nfs4
quit <b>-p</b> <b>&quot;Found % mounted network filesystems&quot;</b> <b>&quot;${#CEN_MOUNT_ARR[@]}&quot;</b>
<b>findmount</b> <b>-t</b> -
quit <b>-p</b> <b>&quot;Found % mounted filesystems&quot;</b> <b>&quot;${#CEN_MOUNT_ARR[@]}&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># find device by label
<b>findmount</b> <b>-d</b> <b>-l</b> <b>&quot;my-drive&quot;</b> || quit <b>&quot;device not mounted&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># get label for device
<b>findmount</b> <b>-r</b> label /dev/sda1 &amp;&amp; message <b>&quot;Label:&quot;</b> <b>&quot;$CEN_MNT_DIR&quot;</b></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># what is mounted at /mnt/xxx?
<b>findmount</b> <b>--</b> - <b>&quot;/mnt/xxx&quot;</b> &amp;&amp; message <b>-p</b> \
    <b>&quot;device=%s (%s filesystem)&quot;</b> <b>&quot;$CEN_MOUNT_DEV&quot;</b> <b>&quot;$CEN_MOUNT_FS&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># get list of mounts: &lt;device&gt; &lt;mountpoint&gt; &lt;fstype&gt; &lt;options&gt;
<b>findmount</b> <b>-a</b>
splitjoin <b>&quot;message -a&quot;</b> <b>-i</b> <b>CEN_MOUNT_ARR</b></pre></div>
</div>
</section>
</article>
<div class='def-break'></div>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_lib.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='#top'>[Top of Page]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_pip.html'>[next &gt;&gt;]</a></div>
</div></nav>
</body></html>
