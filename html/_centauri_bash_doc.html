<!DOCTYPE html>
<html><head><meta charset='UTF-8'></meta>
<title>centaurihelp â”€ _centauri_bash_doc</title>
<link rel='stylesheet' type='text/css' href='default.css'></link>
<script type='text/javascript' src='default.js'></script>
</head><body><article id='top'>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_dbg.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='content.html#top'>[Content]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_dyn.html'>[next &gt;&gt;]</a></div>
</div></nav>
<section id='section-1'>
<div id='_centauri_bash_doc' class='item-module'>
<span>Module</span><span> - </span><span>_centauri_bash_doc</span><span> - </span><span><a href="index.html">Centauri Bash Library</a> Documentation Support</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'>. <b>_centauri_bash_doc</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>The <a href="#documentation">documentation()</a> function of this module can extract documentation blocks from <b>_centauri_bash_xxx</b> modules and pass them to a user supplied callback function for output formatting.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The module also contains some <i>topic</i> documentation blocks for general information about <b>_centauri_bash_lib</b>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Syntax:</div>
<div class='def-block'>Document blocks are sequences of bash comments all starting in column 1. A block must contain at least four comment lines and must start and end with a marker comment.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>A marker comment is made of at least 8 hyphens. The 1st marker starts a documentation block, any non-comment line or another marker end a documentation block.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The marker must be followed by one or more subject lines.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Each <i>subject</i> starts with a <i>key</i>, followed by a subject <i>kind</i> and a subject <i>text</i> (space separated):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>&lt;subject&gt; := &lt;key&gt; &lt;kind&gt; &lt;text&gt;</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>&lt;kind&gt; :=  <b>-</b>  for a function doc block
&lt;kind&gt; :=  <b>=</b>  for a module doc block
&lt;kind&gt; :=  <b>+</b>  for a topic doc block</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The subject list is closed by an empty comment and is followed by the documentation body. See <a href="#documentationworker">Documentation (worker)</a> for the proposed body syntax. This module itself implies no body syntax.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Invalid, unrecognized syntax is silently ignored.</div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-text'><pre># ------------------------------------------------------------------
# Introduction + Example of a topic block
#
# This is the documentation block body.
# ------------------------------------------------------------------</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># ------------------------------------------------------------------
# documentation - Example of a function doc block
#
# Call:      documentation &lt;arg&gt;...
#
# Return:    <b>true</b> on success
#
# This is a remark.
# ------------------------------------------------------------------</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>Code to parse a file, calls function: parse_block <i>start</i> <i>text</i>...<pre>parse_file() {
    local _line _coun=0 _blck _isok _frst
    while : ; do                            # loop over blocks
        _blck=() ; _isok=
        while read _line ; do               # search start of block
            ((_coun += 1))
            [[ <b>&quot;$_line&quot;</b> == \#\ ----* ]] &amp;&amp; break
        done
        _frst=$((_coun + 1))

        for _isok in 0 0 0 1 ; do           # check mimimum size
            read _line || return
            ((_coun += 1))
            [[ <b>&quot;$_line&quot;</b> == \#* ]] || break
            [[ <b>&quot;$_line&quot;</b> == \#\ ----* ]] &amp;&amp; break
            _blck+=(<b>&quot;$_line&quot;</b>)
        done
        [ <b>&quot;$_isok&quot;</b> = 1 ] || continue

        while read _line ; do               # get block body lines
            ((_coun += 1))
            if [[ <b>&quot;$_line&quot;</b> != \#* ]] ; then
                _isok= ; break
            fi
            [[ <b>&quot;$_line&quot;</b> == \#\ ----* ]] &amp;&amp; break
            _blck+=(<b>&quot;$_line&quot;</b>)
        done
        [ <b>&quot;$_isok&quot;</b> = 1 ] &amp;&amp; parse_block <b>&quot;$_frst&quot;</b> <b>&quot;${_blck[@]}&quot;</b>
    done &lt; <b>&quot;$file&quot;</b>
}</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remark:</div>
<div class='def-block'>Copyright Dr. J. Pfennig (c) 2019-2022</div>
</div>
</section>
<section id='section-2'>
<div id='commandsyntax' class='item-topic'>
<span>Topic</span><span> - </span><span>Command Syntax</span><span> - </span><span>Options, Verbs and Arguments</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>The <a href="_centauri_bash_lib.html#main">main()</a> function parses the bash command line arguments. It knows about <b>options</b>, <b>verbs</b> (optional) and <b>arguments</b>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><pre><b>-</b>&lt;letter&gt; [&lt;value&gt;]         short name, optional argument
<b>-</b>&lt;letter&gt;[&lt;value&gt;]

<b>--</b>&lt;name&gt; [&lt;value&gt;]          long name, optional argument
<b>--</b>&lt;name&gt;=&lt;value&gt;
<b>--</b>&lt;name&gt;:&lt;value&gt;
<b>--</b>&lt;name&gt;=&quot;&lt;value&gt;&quot;          &lt;value&gt; may contain spaces

<b>--</b>                          separator for verbs

<b>---</b>                         no option or verb parsing behind,
                            every word that follows is taken
                            literally as an argument</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>predefined <b>options</b> use lower case short names, user added <b>options</b> should use upper case short names. Only the first three characters of long option names should be significant.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>When parsing a command line <b>options</b> are extracted as a first step. So options can be placed anywhere (but before <b>---</b>).</div>
</div>
<div class='def-row'>
<div class='def-label'>Verbs:</div>
<div class='def-block'>Are names for actions. Only the first three characters of a name should be significant. A command line can have multiple <b>verbs</b>, each <b>verb</b> can be followed by any number of <b>arguments</b>. Multiple <b>verbs</b> must be separated by <b>--</b> (two minus signs):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>&lt;verb&gt; [&lt;arg&gt;...] [<b>--</b> &lt;verb&gt; [&lt;arg&gt;...]]...</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-text'>Here <b>hello</b> is a script using _centauri_bash_lib ...<pre>hello <b>-d</b> <b>-F</b>2 <b>&quot;want to fly&quot;</b>
hello <b>--dryrun</b> <b>--format</b>=2 <b>&quot;want to fly&quot;</b>
hello flight <b>&quot;New York&quot;</b> <b>--</b> book 2 economy <b>--</b> pay</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>In a command line the single <b>-</b> (minus sign) is treated as an argument and has no special meaning, but by convention this is used for place-holders (no value).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Option values starting with <b>-</b> must use the form: <b>--</b><i>name</i><b>=&quot;</b><i>value</i><b>&quot;</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Argument values starting with <b>-</b> can only follow the <b>---</b> marker. After this even <b>--</b> is no longer a <b>verb</b> separator but an <b>argument</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Command line processing first removes the <b>options</b> and their values from the invokation arguments and then calls <a href="_centauri_bash_dbg.html#runuser">run()</a> or does <b>verb</b> processing.</div>
</div>
</section>
<section id='section-3'>
<div id='commandline' class='item-topic'>
<span>Topic</span><span> - </span><span>Command Line</span><span> - </span><span>How main() uses options(), actions() or run() and usage()</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>The before mentioned <a href="_centauri_bash_lib.html#main">main()</a> function performs the following steps:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>(1) Extract options and option arguments from the command line
(2) Pass every option to a user supplied <a href="_centauri_bash_dbg.html#optionsuser">options()</a> function
(3) If <a href="_centauri_bash_dbg.html#optionsuser">options()</a> does not exist or or does not handle the option
    try an internal default (if existing)
(4) Report any errors, call the <a href="_centauri_bash_use.html#usageuser">usage()</a> function if appropriate
(5) Was the <b>-r</b> option passed to <b>_centauri_bash_lib</b>? If so or if
    <a href="_centauri_bash_dbg.html#actionsuser">actions()</a> does not exist call <a href="_centauri_bash_dbg.html#runuser">run()</a>
(6) Otherwise call <a href="_centauri_bash_dbg.html#actionsuser">actions()</a> for every verb and its arguments
(7) Stop calling <a href="_centauri_bash_dbg.html#actionsuser">actions()</a> after a call to <a href="_centauri_bash_lib.html#error">error()</a>. See <b>--zombie</b>.
(8) Call <a href="_centauri_bash_lib.html#quit">quit()</a> to terminate the script.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>These functions are implemented in module <b>_centauri_bash_lib</b>:
-  <a href="_centauri_bash_lib.html#main">main()</a>  the main function
-  a default implementation of <a href="_centauri_bash_use.html#usageuser">usage()</a> to implement <b>--help</b>
-  <a href="_centauri_bash_lib.html#quit">quit()</a>  to terminate the script</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>The script can optionally provide the following:
-  <a href="_centauri_bash_dbg.html#optionsuser">options()</a>  for option parsing
-  <a href="_centauri_bash_dbg.html#actionsuser">actions()</a> -or- <a href="_centauri_bash_dbg.html#runuser">run()</a>  to do the work
-  <a href="_centauri_bash_use.html#usageuser">usage()</a>  to implement <b>--help</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Hooks:</div>
<div class='def-block'>The extension modules make use of so-called hooks (and scripts also can use them):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>-  <b>CEN_HOOK_OPTIONS</b>  hook <a href="_centauri_bash_dbg.html#optionsuser">options()</a> parsing
-  <b>CEN_HOOK_ACTIONS</b>  hook <a href="_centauri_bash_dbg.html#actionsuser">actions()</a> handling
-  <b>CEN_HOOK_GETLINE</b>  acquire input, see <a href="_centauri_bash_lib.html#confirm">confirm()</a>
-  <b>CEN_HOOK_QUIT</b>     terminate the script, see <a href="_centauri_bash_lib.html#quit">quit()</a></div>
</div>
</section>
<section id='section-4'>
<div id='defaultoptions' class='item-topic'>
<span>Topic</span><span> - </span><span>Default Options</span><span> - </span><span>Command line options provided by the library</span></div>
<div class='def-row'>
<div class='def-label'>Common:</div>
<div class='def-block'>The function <a href="_centauri_bash_lib.html#main">main()</a> implements the follwing options internally (this can be overridden via <a href="_centauri_bash_dbg.html#optionsuser">options()</a>):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>-d</b>  <b>--dryrun</b>      make no changes (often used with <b>-v</b> <b>-v</b>)
<b>-f</b>  <b>--force</b>       (<b>_centauri_bash_lib -f</b>) by less prudent
<b>-g</b>  <b>--gui</b>=        (<b>_centauri_bash_lib -g</b>) enable console/window
<b>-h</b>  <b>--help</b>        show <a href="_centauri_bash_use.html#usageuser">usage()</a> info and quit
<b>-i</b>  <b>--include</b>=    (<b>_centauri_bash_lib -i</b>) used by <a href="_centauri_bash_lib.html#filter">filter()</a>
<b>-n</b>  <b>--no</b>          (<b>_centauri_bash_lib -y</b>) used by <a href="_centauri_bash_lib.html#confirm">confirm()</a>
<b>-q</b>  <b>--quiet</b>       not output except for errors
<b>-s</b>  <b>--silent</b>      (<b>_centauri_bash_lib -s</b>) less output
<b>-v</b>  <b>--verbose</b>     verbose output, enable <a href="_centauri_bash_lib.html#trace">trace()</a>
<b>-x</b>  <b>--exclude</b>=    (<b>_centauri_bash_lib -i</b>) used by <a href="_centauri_bash_lib.html#filter">filter()</a>
<b>-y</b>  <b>--yes</b>         (<b>_centauri_bash_lib -y</b>) used by <a href="_centauri_bash_lib.html#confirm">confirm()</a>
<b>-z</b>  <b>--zombie</b>      continue after <a href="_centauri_bash_lib.html#error">error()</a> (<b>verbs</b> only))</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    <b>--embed</b>=      used by <a href="_centauri_bash_lib.html#embed">embed()</a> to pass the callers <b>CEN_NAME</b>
    <b>--info</b>        version info, install/uninstall see <a href="_centauri_bash_ins.html#installation">Installation</a>
    <b>--pager</b>=      pass output through pager program, see <a href="_centauri_bash_pip.html#syspager">syspager()</a>
    <b>--trace</b>       trace <b>actions</b> or <a href="_centauri_bash_dbg.html#runuser">run()</a> via <b>&quot;set -x&quot;</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Extras:</div>
<div class='def-text'>More options are defined by some modules:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>-b</b>  <b>--batch</b>=      see <a href="_centauri_bash_bat.html">_centauri_bash_bat</a>
<b>-l</b>  <b>--logfile</b>=</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>-d</b>  <b>--device</b>=     see <a href="_centauri_bash_iom.html">_centauri_bash_iom</a>
<b>-m</b>  <b>--mount</b>=
<b>-i</b>  <b>--input</b>=
<b>-i</b>  <b>--output</b>=
<b>-r</b>  <b>--read</b>=
<b>-w</b>  <b>--write</b>=</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>-s</b>  <b>--syslog</b>=     see <a href="_centauri_bash_svc.html">_centauri_bash_svc</a></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>-t</b>  <b>--trash</b>=      see <a href="_centauri_bash_tra.html">_centauri_bash_tra</a></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>-w</b>  <b>--windows</b>=    see <a href="_centauri_bash_win.html">_centauri_bash_win</a></div>
</div>
</section>
<section id='section-5'>
<div id='initialization' class='item-topic'>
<span>Topic</span><span> - </span><span>Initialization</span><span> - </span><span>How <a href="index.html">_centauri_bash_lib</a> and modules are found</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>The library is loaded using a proxy named <b>_centauri_bash_lib</b>. That file should be sym-linked to <b>&quot;/usr/local/bin&quot;</b>. And the later should be in the current PATH environment. This is the most simple way.</div>
</div>
<div class='def-row'>
<div class='def-label'>Path:</div>
<div class='def-block'>Any user script is either linked via <b>&quot;/usr/local/bin&quot;</b> or is called with an explicit path. In the later case that path is added to PATH environment in the hope to locate <b>_centauri_bash_lib</b> that way.</div>
</div>
<div class='def-row'>
<div class='def-label'>Environment:</div>
<div class='def-block'> Most important is the environment variable <b>CEN_ROOT</b>. It is used internally to locate most components and data. If <b>CEN_ROOT</b> is not yet set, the loading of <b>_centauri_bash_lib</b> causes it to set <b>CEN_ROOT</b>.  All modules and scripts are installed at <b>CEN_ROOT</b> or its children <b>CEN_TOOLS</b> and <b>CEN_LIBRARY</b>, see <a href="_centauri_bash_ins.html#installation">Installation</a>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>If <b>CEN_ROOT</b> is not set at load time, <b>_centauri_bash_lib</b> proxy also sanitizes <b>TMP</b>, <b>TMPDIR</b> and <b>XDG_RUNTIME_DIR</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>A slight speed-up can be achived by presetting <b>CEN_ROOT</b> - for example in bash <b>&quot;.profile&quot;</b> or <b>&quot;.bashrc&quot;</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Modules are loaded via <b>&quot;embed -m &lt;name&gt;&quot;</b> where name is a full name like <b>_centauri_bash_use</b> or an absolute path. See <a href="_centauri_bash_lib.html#embed">embed()</a>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The GNU string translations must be at <b>&quot;$CEN_ROOT/locale/&lt;lang&gt;&quot;</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Here <b>&quot;/usr/local/bin&quot;</b> was used as an example only, any other installation path can be configured, see <a href="_centauri_bash_ins.html#installation">Installation</a>.</div>
</div>
</section>
<section id='section-6'>
<div id='versioning' class='item-topic'>
<span>Topic</span><span> - </span><span>Versioning</span><span> - </span><span>How <a href="index.html">_centauri_bash_lib</a> and modules are versioned</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>This topic describes how the version of a user script and the versions of library modules are validated.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The concept is that of an API version, e.g. <a href="_centauri_bash_lib.html">_centauri_bash_lib</a> defines the current and the minimum version. Example:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre><b>CEN_MODULES</b>[<b>&quot;_centauri_bash_lib&quot;</b>]=<b>&quot;0.90:1:0&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Here the library version is <b>&quot;0.90&quot;</b>, current API version <b>&quot;1&quot;</b> and minimum API version is <b>&quot;0&quot;</b>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Modules:</div>
<div class='def-block'>A module specifies the lowest acceptable API version it can use:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre><b>CEN_MODULES</b>[<b>&quot;_centauri_bash_bat&quot;</b>]=<b>&quot;0.10:1&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>An attempt to load a module will fail if the module requests an API version above the one defined by <a href="_centauri_bash_lib.html">_centauri_bash_lib</a> or if the minimum API version (of _centauri_bash_lib) is higher than the lowest acceptable API version of the library. The check is made by <a href="_centauri_bash_lib.html#embed">embed()</a> when it loads a module by calling <a href="_centauri_bash_lib.html#apicheck">apicheck()</a>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Scripts:</div>
<div class='def-block'>User scripts use the same logic as modules (but if a script does not specify a version no version check takes place):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>PATH+=<b>&quot;:${0%/*}&quot;</b> . _centauri_bash_lib <b>-r</b> <b>&quot;$0&quot;</b> <b>&quot;0.00:1&quot;</b> || exit 2</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>In the above example the lowest acceptable API version is <b>&quot;1&quot;</b>. If the version check fails the script will quit with a fatal error. The check is made when <a href="_centauri_bash_lib.html">_centauri_bash_lib</a> is loaded.</div>
</div>
</section>
<section id='section-7'>
<div id='debugging' class='item-topic'>
<span>Topic</span><span> - </span><span>Debugging</span><span> - </span><span>Debug support in the <a href="index.html">Centauri Bash Library</a></span></div>
<div class='def-row'>
<div class='def-label'>Verbose:</div>
<div class='def-block'>Script code can be instrumented with <a href="_centauri_bash_lib.html#trace">trace()</a> calls for extra output (command-line option <b>--verbose</b>):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>trace <b>&quot;This is a simple trace message&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Option <b>--verbose</b> also sets <b>CEN_TRACE</b>=<b>&quot;trace&quot;</b> (which initially is set to &apos;:&apos;). This is a more efficient way of debug instrumentation. Internally the library itself uses <b>CEN_TRACE</b> to provide additional information:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>$<b>CEN_TRACE</b> <b>&quot;This is used internally and is OK for user script&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Even more debug information can be enabled by using <b>--verbose</b> twice. This also initialises the variable <b>CEN_TRACE</b>2 (which initially is set to &apos;:&apos;):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>$<b>CEN_TRACE</b>2 <b>&quot;Used with --verbose --verbose&quot;</b></pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Loading the <a href="_centauri_bash_dbg.html">_centauri_bash_dbg</a> module causes <b>CEN_DEBUG</b> to be set, see <a href="_centauri_bash_dbg.html#debug">debug()</a> for details:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>debug <b>&quot;Ad-hoc debug statement&quot;</b> my_var some_array
$<b>CEN_DEBUG</b> <b>&quot;on after module load&quot;</b> x y</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>With <b>--verbose</b> <b>--verbose</b> on, the <a href="_centauri_bash_lib.html#fatal">fatal()</a> function will print a stack trace.</div>
</div>
<div class='def-row'>
<div class='def-label'>Trace:</div>
<div class='def-block'>bash has a built in trace feature. The library enables tracing of actions or <a href="_centauri_bash_dbg.html#runuser">run()</a> with command-line option <b>--trace</b>. It is recommended to use a pager with <b>--pager</b>=yes because large amounts of output are generated.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The <b>--trace</b> option will suppress <a href="_centauri_bash_lib.html#message">message()</a>, <a href="_centauri_bash_lib.html#warning">warning()</a> and <a href="_centauri_bash_lib.html#trace">trace()</a> calls to avoid confusing output (see variable <b>CEN_NOTRACE</b>).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>example_report() {
    $<b>CEN_NOTRACE</b> return         # don&apos;t run in trace mode
    # code not to be traced
}</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Avoid using &apos;set <b>-x</b>&apos;. Instead the <a href="_centauri_bash_dbg.html#debug">debug()</a> function should be used to control tracing in scripts:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>debug <b>-t</b> on                     # turn trace on ...
    # code to be traced
debug <b>-t</b> off                    # trace off</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>my_function() {
    $<b>CEN_DEBUG</b> <b>-f</b> <b>--</b> &quot;$*        # trace this function
    # code to be traced
}</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>$<b>CEN_DEBUG</b> <b>-c</b> <b>--</b> <b>&quot;$*&quot;</b>           # report a function call</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Function <a href="_centauri_bash_dbg.html#debug">debug()</a> can also enable tracing of <a href="_centauri_bash_lib.html#main">main()</a>, <a href="_centauri_bash_dbg.html#optionsuser">options()</a>, <a href="_centauri_bash_dbg.html#actionsuser">actions()</a> and <a href="_centauri_bash_lib.html#quit">quit()</a>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Traps:</div>
<div class='def-block'>Variable <b>CEN_QUIT_TRAP</b>=<i>signal</i> controls the initialization of an internal command_not_found_handel() function at main module load (also see <a href="_centauri_bash_lib.html#context">context()</a>). This would print a friendly message (or a stack trace) when a command is not found and terminate the script. This feature causes little overhead and is thus enabled by default.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Do not use <b>&quot;set -e&quot;</b> or <b>&quot;set -eE&quot;</b> in your scripts. Use feature option &apos;<b>-e</b>&apos; for <a href="_centauri_bash_lib.html">_centauri_bash_lib</a> or <a href="_centauri_bash_lib.html#context">context()</a> to enable error traps. But be warned: the library is not safe to use this, only some code paths are, mostly in _centauri_bash_lib and _centauri_bash_ext.</div>
</div>
<div class='def-row'>
<div class='def-label'>Abort:</div>
<div class='def-block'>Call the <a href="_centauri_bash_lib.html#fatal">fatal()</a> function if something unforseen is discoverd. For internal errors the <b>-t</b> option is used to trigger a stack trace:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>[ <b>&quot;$result&quot;</b> = <b>&quot;42&quot;</b> ] &amp;&amp; fatal <b>-t</b> <b>&quot;this gets boring&quot;</b> <b>&quot;$result&quot;</b></pre></div>
</div>
</section>
<section id='section-8'>
<div id='globalvariables' class='item-topic'>
<span>Topic</span><span> - </span><span>Global Variables</span><span> - </span><span>Library defined Variables</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>All internal variable names must start with <b>CEN_</b>. The lists in this topic are not comprehensive but document only some important variables declared by the main module</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_TITLE</b>          (used defined) very short script description
<b>CEN_LEGAL</b>          (user defined) specifies author and license</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_ROOT</b>           (set by proxy) installation folder
<b>CEN_LIBRARY</b>        (set by proxy) short for <b>&quot;$CEN_ROOT/library&quot;</b>
<b>CEN_TOOLS</b>          (set by proxy) short for <b>&quot;$CEN_ROOT/tools&quot;</b></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_PATHS</b>          filesystem prefix for non FSH-compatible install</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_ACTARR</b>         action argument array
<b>CEN_ACTION</b>         current action, see <a href="_centauri_bash_dbg.html#actionsuser">actions()</a>
<b>CEN_ARGOPT</b>         option argument, see optarg() and main()
<b>CEN_ARGS</b>           arguments used, see arguments() or options()
<b>CEN_AUTOIND</b>        autoindent flag, see _cen_message() <b>-a</b>
<b>CEN_CMDARGS</b>        array of script arguments (options removed)
<b>CEN_CMDINDX</b>        index in <b>CEN_CMDARGS</b>[]
<b>CEN_CMDOPTS</b>        array of script options
<b>CEN_EMBED</b>          see <b>--embed</b> option
<b>CEN_EXIT</b>           error status, see <a href="_centauri_bash_lib.html#error">error()</a>
<b>CEN_HISTORY</b>        use history/readline in <a href="_centauri_bash_lib.html#confirm">confirm()</a>
<b>CEN_NAME</b>           script name, see <a href="_centauri_bash_lib.html">_centauri_bash_lib</a>
<b>CEN_NOCOLS</b>         set for initial COLUMNS=0, shortens trace output lines
<b>CEN_PACKAGE</b>        non-zero for packaged script, see <a href="uglify.html">uglify</a> tool
<b>CEN_QUIT_SANE</b>      run <b>&quot;stty sane&quot;</b> in quit if non-zero
<b>CEN_QUIT_TRAP</b>      default signal to enter <b>&quot;quit -s 4&quot;</b>
<b>CEN_QUIT_WAIT</b>      wait after quit
<b>CEN_VERB</b>           <b>--verbose</b>|<b>--quiet</b> level, <b>0</b>:quiet  <b>1</b>:normal  <b>2</b>:verbose
<b>CEN_VERSION</b>        script version, see <a href="#versioning">versioning</a> and <a href="_centauri_bash_lib.html">_centauri_bash_lib</a>
<b>CEN_YESNO</b>          see <b>--yes</b> and <b>--no</b> options</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_RUN_MIN_ARGS</b>   <a href="_centauri_bash_dbg.html#runuser">run()</a> min arg count (<b>-</b>:=no checks)
<b>CEN_RUN_MAX_ARGS</b>   <a href="_centauri_bash_dbg.html#runuser">run()</a> max arg count (<b>+</b>:=no limit)</div>
</div>
<div class='def-row'>
<div class='def-label'>Functions:</div>
<div class='def-block'>The variables contain a function name or the &apos;:&apos; noop command</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_PAGER</b>          set by <a href="_centauri_bash_pip.html#syspager">syspager()</a> to invoke a pager or &apos;:&apos; otherwise</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_DEBUG</b>          optimization: call <a href="_centauri_bash_dbg.html#debug">debug</a> if loaded or &apos;:&apos; otherwise
<b>CEN_TRACE</b>          optimization: call <a href="_centauri_bash_lib.html#trace">trace()</a> for <b>-v</b> only
<b>CEN_TRACE</b>2         optimization: call <a href="_centauri_bash_lib.html#trace">trace()</a> for <b>-v</b> <b>-v</b> only</div>
</div>
<div class='def-row'>
<div class='def-label'>Maps:</div>
<div class='def-block'>(dictionaries) bash has a scoping problem with maps, they must be declared in <b>_centauri_bash_lib</b> if they are to be global</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_MODULES</b>        loaded extension modules
<b>CEN_WALK_DMAP</b>      used by <a href="_centauri_bash_ext.html#walk">walk()</a>
<b>CEN_AUTOMOUNT_DIR</b>  used by <a href="_centauri_bash_mnt.html#automount">automount()</a>
<b>CEN_USE_OMAP</b>       used by <a href="_centauri_bash_use.html#usageuser">usage()</a>
<b>CEN_CMD_PATH</b>       cached command paths, see <a href="_centauri_bash_lib.html#sysfind">sysfind()</a></div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-block'>internal and user defined names should always start with <b>CEN_OPT_</b></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_OPT_DRYRUN</b>     see <b>--dryrun</b>
<b>CEN_OPT_FORCE</b>      see <b>--force</b>
<b>CEN_OPT_GUI</b>        see <b>--gui</b>
<b>CEN_OPT_INCLEXCL</b>   array, see <b>--include</b> and <b>--exclude</b>
<b>CEN_OPT_SILENT</b>     see <b>--silent</b>
<b>CEN_OPT_TRACE</b>      see <b>--trace</b>
<b>CEN_OPT_ZOMBIE</b>     see <b>--zombie</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Returns:</div>
<div class='def-block'>some functions by default use a global variable for their return value</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>CEN_FOLDER</b>         see <a href="_centauri_bash_lib.html#folder">folder()</a>
<b>CEN_CONFIRM</b>        see <a href="_centauri_bash_lib.html#confirm">confirm()</a></div>
</div>
<div class='def-row'>
<div class='def-label'>Hooks:</div>
<div class='def-text'><b>CEN_HOOK_OPTIONS</b>   option parsing, see <a href="_centauri_bash_dbg.html#optionsuser">options()</a>
<b>CEN_HOOK_ACTIONS</b>   verb dispatching, see <a href="_centauri_bash_dbg.html#actionsuser">actions()</a>
<b>CEN_HOOK_QUIT</b>      script termination, see <a href="_centauri_bash_lib.html#quit">quit()</a></div>
</div>
</section>
<section id='section-9'>
<div id='functionoptions' class='item-topic'>
<span>Topic</span><span> - </span><span>Function Options</span><span> - </span><span>Option parsing for library functions</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>Most library functions are controlled by option arguments. Such options can optionally have values. The parser for this is very simple and is not related to the command line parser of <a href="_centauri_bash_lib.html#main">main()</a>.</div>
</div>
<div class='def-row'>
<div class='def-label'>Rules:</div>
<div class='def-text'>(1) There are only short option names (single letter)
(2) If an option has a value, it is separated by a space
(3) The first non-option argument ends option parsing
(4) Use <b>--</b> to avoid problems with non-option args that
    start with a - character.</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'>This is the parser used by <a href="_centauri_bash_lib.html#filter">filter()</a>:<pre>local _oinv _rval
while [ <b>&quot;${1::1}&quot;</b> = <b>&quot;-&quot;</b> ] ; do
  case <b>&quot;$1&quot;</b> in
    <b>--</b>)   shift ; break ;;
    <b>-f</b>)   _rval=1 ;;
    <b>-i</b>)   _oinv=1 ;;
    <b>-s</b>)   _rval=0 ;;
    *)    _cen_abort - <b>&quot;$1&quot;</b>         # Invalid argument
  esac ; shift
done</pre></div>
</div>
</section>
<section id='section-10'>
<div id='bashfunctions' class='item-topic'>
<span>Topic</span><span> - </span><span>bash Functions</span><span> - </span><span>Function Nesting, Conventions</span></div>
<div class='def-row'>
<div class='def-label'>Naming:</div>
<div class='def-block'>Internal functions are named <b>_cen_xxx</b> if they are global or <b>___xxx</b> if they are declared inside another function (nested).</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'><pre># internal and nested functions are frequently used:

_cen_example() {                       # internal global
     ___say_hello() { echo <b>&quot;hello&quot;</b> ; }  # nested
     ___say_hello                       # this is ok
}
_cen_example                           # this is ok

___say_hello                           # THIS IS BAD
___say_hello() { echo <b>&quot;another&quot;</b> ; }    # THIS IS WORSE</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Nesting:</div>
<div class='def-block'>bash does not really support nested functions. Functions are just statements, e.g. they are instantiated when the function definition is executed by the shell (which differs from calling the instance).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>If a function is declared inside another function, the nested function is instantiated each time when the outer function gets executed.</div>
</div>
<div class='def-row'>
<div class='def-label'>Warning:</div>
<div class='def-block'>The nested functions are global! In practice they can be called from outside the outer function and they can be redefined. Code must be written to take this into account. NEVER CALL A NESTED FUNCTION FROM OUTSIDE THE CONTAINER FUNCTION.</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'><pre># functions can be redefined, which is sometimes used by
# extension modules:

hello() { echo <b>&quot;working day&quot;</b> ; }        # initial instance
hello
weekend &amp;&amp; hello() { echo <b>&quot;weekend&quot;</b> ; } # conditionally redefined
hello</pre></div>
</div>
</section>
<section id='section-11'>
<div id='bashvariables' class='item-topic'>
<span>Topic</span><span> - </span><span>bash Variables</span><span> - </span><span>Scoping Rules, References, Conventions</span></div>
<div class='def-row'>
<div class='def-label'>Global:</div>
<div class='def-block'>By convention global variables are defined using upper case names In the form <b>CEN_</b>&lt;module&gt;<b>_</b>&lt;name&gt;. The definitions are placed at the top of the module. Only global variables are static.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'><b>declare -A</b> (to create a dictionary) is weird (or broken?). All dictionaries used in _centauri_bash_lib MUST be defined in the main module.</div>
</div>
<div class='def-row'>
<div class='def-label'>Scoping:</div>
<div class='def-block'>When bash searches a variable is walks back in the call stack until it encounters a variable definition. If not found anywhere else the variable becomes global.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>As a consequence each varable definition may shield an earlier definition. This is sometimes confusing in callback functions. To mitigate this problem the library prefixes local names with an underscore. For example <b>_item</b> is used by the library whereas <b>item</b> should be a user define variable.</div>
</div>
<div class='def-row'>
<div class='def-label'>References:</div>
<div class='def-block'> bash has reference variables:<b>local -n _vref=</b>&lt;name&gt; . These allow a functions to return values. This feature must be used with great care because of possible typing errors and the scoping rules:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>demo() {
   local <b>-n</b> _vref=<b>&quot;$1&quot;</b> ; local _test=1
   _vref=<b>&quot;$2&quot;</b>
}
local _test=2
demo _test 3 ; echo <b>&quot;_test=$_test (not 3 as expected)&quot;</b>
local test=4
demo test 5 ; echo <b>&quot;test=$test (expecting 5)&quot;</b></pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Arrays:</div>
<div class='def-block'>bash does lazy initialization of maps and arrays. Defining one of these only sets a flag and is quite fast. Here some conventions:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre><b>CEN_EXT_MOUNTS</b>=()           # declare an static, global array
declare <b>-A</b> <b>CEN_WALK_DMYP</b>    # declare a map (must be global)
local _stxt=()              # declare a local array
_stxt=()                    # drop array content</pre></div>
</div>
</section>
<section id='section-12'>
<div id='documentation' class='item-function'>
<span>Function</span><span> - </span><span>documentation</span><span> - </span><span>The source code documentation extractor</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>documentation</b> [<b>-s</b>] [<b>-c</b>|<b>-m</b>] <i>worker</i> <i>file</i>       # single file mode</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><b>documentation</b> [<b>-e</b>] <b>-f</b> <i>list</i>                   # set file list
<b>documentation</b> <b>-e</b>|<b>-d</b> [<i>cache</i>]                  # enable/drop cache
<b>documentation</b> <b>-i</b> <i>file</i>...                     # (re)set include list
<b>documentation</b> <b>-l</b> [<b>-c</b>|<b>-m</b>] <i>worker</i> [<i>prep</i>]       # run file list
<b>documentation</b> <b>-q</b> <i>pattern</i>...                  # set query filter
<b>documentation</b> <b>-t</b> <i>name</i> <i>pattern</i>...             # query test
<b>documentation</b> [<b>-d</b>] <b>-x</b>                        # clear list/cache</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-c</b>  Produce table-of-content, parse no block bodies
<b>-d</b>  Delete table-of-content cache file
<b>-e</b>  Enable/create table-of-content cache
<b>-f</b>  Setup file list mode (does not override non-empty list)
<b>-i</b>  Set a file filter for option <b>-l</b>
<b>-l</b>  Run file list set via <b>-f</b> option
<b>-m</b>  Produce module list, stops after 1st block in file
<b>-p</b>  Alternate parser
<b>-s</b>  do not generate trace messages
<b>-q</b>  Set filter (in file list) for <i>pattern</i>
<b>-t</b>  Test if <i>name</i> matches any <i>pattern</i>...
<b>-x</b>  Clear file list and in-memory cache</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>worker</i>  worker callback, see <a href="#documentationworker">documentation (worker)</a>
<i>file</i>    input file name
<i>prep</i>    per-file callback for list mode
<i>list</i>    list of <i>file</i>... for list mode
<i>name</i>    name of a cache entry
<i>pattern</i> pattern to be searched in cache
<i>cache</i>   set cache file path</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Any sequence of -/+/= in the file list sets a filter on element kind function/topic/module.</div>
</div>
<div class='def-row'>
<div class='def-label'>Return:</div>
<div class='def-block'><b>true</b> at success or <b>false</b> otherwise. When caching is enabled, the variable <b>CEN_DOC_APICHANGE</b> indicates if index pages must be rebuilt:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    <i>empty</i>    current, no changes
    <b>0</b>        at least one module changed but api not changed
    <b>1</b>        don&apos;t know, no data: regenerate index
    <b>2</b>        api was changed: regenerate index</div>
</div>
<div class='def-row'>
<div class='def-label'>Caching:</div>
<div class='def-block'>Table-of-content data can be cached to speed up calls with <b>-c</b> and <b>-m</b> options. Caching works only in multi file mode (option <b>-f</b>) and must be explicitly enabled via option <b>-e</b>. When caching is not enabled the <b>-i</b> option is ignored. The <b>-q</b> option searches the toc cache for matching files and adds the files to the filter list (<b>-i</b> option). The cache is saved to a file (folder <b>~/.cache</b> or <b>~/.config</b>).</div>
</div>
<div class='def-row'>
<div class='def-label'>Example:</div>
<div class='def-text'>(1) extract toc and <b>documentation</b> blocks in single file mode<pre><b>documentation</b> <b>-c</b> toc_function _centauri_bash_ext
<b>documentation</b>    elt_function _centauri_bash_ext</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>(2) use file list mode and caching for toc and doc blocks<pre><b>documentation</b> <b>-s</b> <b>-e</b> <b>-f</b> _centauri_bash_lib _centauri_bash_ext
<b>documentation</b> <b>-s</b> <b>-l</b> <b>-c</b> toc_function
<b>documentation</b> <b>-s</b> <b>-l</b>    elt_function
<b>documentation</b> <b>-s</b> <b>-d</b> <b>-x</b>              # delete cache file too</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>(3) search in toc for patterns &apos;*folder*&apos;, &apos;*file*&apos;, &apos;*path*&apos;<pre><b>documentation</b> <b>-e</b> <b>-f</b> _centauri_bash_lib _centauri_bash_ext
<b>documentation</b> <b>-q</b> folder file
<b>documentation</b> <b>-q</b> += path            # no functions (see -+= filter)
<b>documentation</b> <b>-l</b> elt_function
<b>documentation</b> <b>-x</b></pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Parsing:</div>
<div class='def-block'>The <b>documentation</b> function reads from <i>file</i>, extracts documentation blocks and passes them to the caller supplied <i>worker</i> callback.  Reading stops if the worker returns a non-zero status.  The last worker status is used as return value.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The <a href="_centauri_bash_lib.html">_centauri_bash_lib</a> source code documentation is formatted in blocks, each block having a kind. These are the defined kinds (no other allowed):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    <b>module</b>    - a <b>_centauri_bash_lib</b> module
    <b>function</b>  - documentation for a function
    <b>topic</b>     - some other documentation</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The first documentation block should always be a module block and each module must have a version line that follows the module block:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre><b>CEN_MODULES</b>[<b>&quot;_centauri_bash_doc&quot;</b>]=<b>&quot;0.10&quot;</b>   # version example</pre></div>
</div>
</section>
<section id='section-13'>
<div id='documentationworker' class='item-function'>
<span>Function</span><span> - </span><span>documentation (worker)</span><span> - </span><span>Documentation block processor</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><i>worker</i> <i>file</i> <i>start</i>              # start of doc block
<i>worker</i> <i>file</i> <i>entry</i>...           # documentation block
<i>worker</i> <i>file</i> <i>end</i>                # end of file</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>file</i>     input file name
<i>entry</i>    <i>header</i> or <i>body</i> line belonging to a block
<i>start</i>    specical start-of-block <i>entry</i>
<i>end</i>      specical end-of-file <i>entry</i></div>
</div>
<div class='def-row'>
<div class='def-label'>Format:</div>
<div class='def-text'>Before the each documentation block and after the last block of
the file the processor calls the <i>worker</i> with a special <i>entry</i>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>The <i>worker</i> receives a numer of <i>entry</i> lines, belonging to one
documentation block. The block starts with a least one <i>header</i>
<i>entry</i> followed by any number of <i>body</i> <i>entries</i>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>Each <i>header</i> <i>entry</i> is a line consisting of up to four fields:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    &lt;line-number&gt;<b>:</b>&lt;kind-char&gt;&lt;name&gt;<b>:</b>&lt;text&gt;</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>Each <i>body</i> <i>entry</i> has tree fields (body follows header):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    &lt;line-number&gt;<b>:-</b>&lt;text&gt;</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>The <i>start</i> <i>entry</i> has a block count (starting with <b>0</b>):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    &lt;line-number&gt;<b>:B</b>&lt;block-count&gt;</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>The <i>end</i> <i>entry</i> just passes the total line count:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    &lt;total-lines&gt;<b>:E</b></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>The option <b>-c</b> is used, before each module <i>entry</i> the module
version is signaled:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>    &lt;line-number&gt;<b>:V</b>&lt;version&gt;</div>
</div>
<div class='def-row'>
<div class='def-label'>Decoding:</div>
<div class='def-text'><pre># the following code snippet can be used to split entries
for entr in <b>&quot;$@&quot;</b> ; do
    local text=<b>&quot;${entr#*:}&quot;</b>  line=<b>&quot;${entr%%:*}&quot;</b>
    local kind=<b>&quot;${text::1}&quot;</b>  text=<b>&quot;${text:1}&quot;</b>
    local name=<b>&quot;${text%%:*}&quot;</b> mesg=<b>&quot;${text#*:}&quot;</b>
    case <b>&quot;$kind&quot;</b> in
        -) text_out <b>&quot;$line&quot;</b> <b>&quot;text&quot;</b> ;;
        M) head_out <b>&quot;$line&quot;</b> <b>&quot;Module&quot;</b>   <b>&quot;$name&quot;</b> <b>&quot;$mesg&quot;</b> ;;
        T) head_out <b>&quot;$line&quot;</b> <b>&quot;Topic&quot;</b>    <b>&quot;$name&quot;</b> <b>&quot;$mesg&quot;</b> ;;
        F) head_out <b>&quot;$line&quot;</b> <b>&quot;Function&quot;</b> <b>&quot;$name&quot;</b> <b>&quot;$mesg&quot;</b> ;;
    esac
done</pre></div>
</div>
</section>
<section id='section-14'>
<div id='formatting' class='item-topic'>
<span>Topic</span><span> - </span><span>Formatting</span><span> - </span><span>How to Format Code Documentation for centaurihelp</span></div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>The Code Documentation is processed by <a href="centaurihelp.html">centaurihelp</a>, which performs formatting on a &apos;per block&apos; base and additionally some &apos;markup&apos;. The blocks (or paragraphs) are groups of lines (obtained via <a href="#documentation">documentation()</a> that are separated by empty lines).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The 1st character of each line is a <b>marker</b>. Usually the text is indented. A block optionally can start with a <b>label</b> line and can have any number of non-empty <b>continuation</b> lines. The <b>label</b> ends with a colon. The colon and the spaces up to the 1st non-blanc character are removed. For a <b>continuation</b> line up to 12 blank characters are removed. Example:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>#+Label:    The 1st line is followed by continuation lines. The label
#           is this example is &apos;Label&apos;. The plus sign is a marker.
#
# Label #2: This is a 2nd block. Labels can only contain letters,
#           numbers and some special characters (but no spaces).</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>A paragraph that is not indented implicitly get the <b>label</b> &apos;Remark&apos;:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>#+Example:  A paragraph ...
#
#           Another paragraph (same label)
#
#+This starts a new paragraph with the label &apos;Remark&apos; because it is
# not indented.
#
#+Another paragraph (same &apos;Remark&apos; label).</pre></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Blocks do not need to have a <b>marker</b>, the examples used <b>&quot;+&quot;</b> for some of the paragraphs to control the layout. See below.</div>
</div>
<div class='def-row'>
<div class='def-label'>Markup:</div>
<div class='def-block'>Some characters have a special interpretation (unless escaped via double apstrophs):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  Â° (degree)      works a a non-breaking space
  Â§ (paragraph)   is used in definition lists for indenting</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>There are also a few markup sequences (which may have no effect on a dumb terminal or for plain text output):</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  &apos;&apos;&apos;             literal apostroph: &apos;
  &apos;&apos;xxx&apos;&apos;         literal: xxx
  **xxx**         bold: <b>xxx</b>
  &quot;xxx&quot;           quoted: <b>&quot;xxx&quot;</b>
  &lt;&lt;xxx&gt;&gt;         italics: <i>xxx</i>
  [[xxx]]         hyperlink, shown underlined
  &lt;&gt;              placeholder (no output)</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Implied syntax notation formatting for smart  displays affects some things that cannot be used for plain text. They are output literally for text (or a dumb terminal). On a <b>linux console</b> or for <b>html</b> they get decorated:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  &lt;name&gt;          (only letters) brackets removed, italics: <i>name</i>
  -X              (single letter option) bold: <b>-X</b>
  --xxx           (long option) bold: <b>--xxx</b>
  --              bold: <b>--</b>
  MY_TEXT         (uppercase letters) bold: <b>MY_TEXT</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Markers:</div>
<div class='def-block'>Usually a comment line starts with <b>&quot;# &quot;</b>, e.g. the first character is a hash and the second character is a space. Instead of the space a <b>marker</b> can be used. The hash and the marker character get removed before further processing. The following <b>markers</b> are defined:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <b>&quot; &quot;</b>  <b>Simple</b>     full decoration, auto formatting
  <b>&quot;+&quot;</b>  <b>Justify</b>    full decoration, auto formatting    (HTML: justify)
  <b>&quot;,&quot;</b>  <b>List</b>       full decoration, minimal formatting (HTML: preformatted)
  <b>&quot;-&quot;</b>  <b>Literal</b>    minimal decoration, no formatting   (HTML: preformatted)
  <b>&quot;.&quot;</b>  <b>Example</b>    minimal decoration, no formatting   (HTML: preformatted)</div>
</div>
<div class='def-row'>
<div class='def-label'>Trimming:</div>
<div class='def-text'>This text starts at column 21, but all leading spaces are
    removed. The 1st <b>continuation</b> lines starts at column 17,
    but only the 1st 12 leading space are removed. The follow-up
line starts at column 13 and is not modified. The 3rd
<b>continuation</b> starts at col 9 and 8 leading spaces are removed.
The last <b>continuation</b> line starts at column 3.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># Trimming:         This text starts at column 21, but all leading spaces are
#               removed. The 1st <b>continuation</b> lines starts at column 17,
#               but only the 1st 12 leading space are removed. The follow-up
#           line starts at column 13 and is not modified. The 3rd
#       <b>continuation</b> starts at col 9 and 8 leading spaces are removed.
# The last <b>continuation</b> line starts at column 3.</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Indenting:</div>
<div class='def-text'>This shows indenting for text lines starting beyond column 13.
    This is indented by 4 (text starts at column 17)
    Starts at column 3 but is indented because it uses the <b>degree</b> char
    The  <b>quoting</b> syntax can also be used to indent
A text starting at column 13 (or before) is not indented.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre># Indenting:  This shows indenting for text lines starting beyond column 13.
#               This is indented by 4 (text starts at column 17)
# Â°   Starts at column 3 but is indented because it uses the <b>degree</b> char
#       The  <b>quoting</b> syntax can also be used to indent
#           A text starting at column 13 (or before) is not indented.</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>A remark block, which is automatically right justified in HTML output is started by a text line (without a label) in colum 1 .. 8. All leading spaces are trimmed.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Multiple remark blocks are automatically labeled as <b>&quot;Remark:&quot;</b> or <b>&quot;Remarks:&quot;</b> and are by default justified (line-breaks are ignored).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'><pre>#   A remark block, which is automatically right justified in HTML output
#       is started by a text line (without a label) in colum 1 .. 8. All leading
#               spaces are trimmed.

#   Multiple remark blocks are automatically labeled as <b>&quot;Remark:&quot;</b> or <b>&quot;Remarks:&quot;</b>
#   and are by default justified (line-breaks are ignored).</pre></div>
</div>
<div class='def-row'>
<div class='def-label'>Justify:</div>
<div class='def-block'>The <b>&quot;+&quot;</b> marker explicitly adjusts a block (line-breaks are ignored).</div>
</div>
<div class='def-row'>
<div class='def-label'>Lists:</div>
<div class='def-text'>There are three simple ways to create lists:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  one    # This is a list with multiple item lines (one per item)
  two    # using the &quot;,&quot; marker.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  â€¢ This list uses the <b>&quot;-&quot;</b> as 1st character to produce bullets
  â€¢ Very long lines can be continued in a very intuitive way,
    just by indenting them.
  â€¢ This is it.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>
[1] This output is using the <b>&quot;-&quot;</b> marker.
[2] This is called <b>literal</b> output (no formatting).
[3] The [n] decoration was added manually. There is
    nothing like automatic numbering.</div>
</div>
<div class='def-row'>
<div class='def-label'>Examples:</div>
<div class='def-block'>Usually code examples a output as a preformatted box in HTML. In text mode the â”ƒ character flags a preformatted line. Such text is never justified. This is how it looks:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'><pre>Using <b>&quot;#.&quot;</b> produces a special
           layout for code examples.</pre></div>
</div>
</section>
</article>
<div class='def-break'></div>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_dbg.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='#top'>[Top of Page]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_dyn.html'>[next &gt;&gt;]</a></div>
</div></nav>
</body></html>
