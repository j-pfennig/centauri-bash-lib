<!DOCTYPE html>
<html><head><meta charset='UTF-8'></meta>
<title>centaurihelp ─ _centauri_bash_sys</title>
<link rel='stylesheet' type='text/css' href='default.css'></link>
<script type='text/javascript' src='default.js'></script>
</head><body onload='initialize("_centauri_bash_sys")'><article id='top'>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_svc.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='content.html#top'>[Content]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_tra.html'>[next &gt;&gt;]</a></div>
</div></nav>
<section id='section-1'>
<div id='_centauri_bash_sys' class='item-module'>
<span>Module</span><span> - </span><span>_centauri_bash_sys</span><span> - </span><span><a href="index.html">centauri-bash-lib</a>: OS integration support</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'>. <b>_centauri_bash_sys</b> [<b>-n</b>]</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-n</b>  do not initialize</div>
</div>
<div class='def-row'>
<div class='def-label'>Variables:</div>
<div class='def-text'>The module sets the following values at load time:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <b>CEN_SYS_STATE_DIR</b>=<b>&quot;$CEN_ROOT/persistent&quot;</b>    # non-volatile
  <b>CEN_SYS_CACHE_DIR</b>=<b>&quot;$CEN_ROOT/transient&quot;</b>     # volatile
  <b>CEN_SYS_STATE_FILE</b>=<b>&quot;$CEN_SYS_STATE_DIR/centaurisystem&quot;</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>Loading this module without <b>-n</b> option causes <a href="#sysversion">sysversion()</a> to be run.  This is used by <b>_centauri_bash_lib</b> to trigger a minimal setup if the calling user is root. The <a href="#sysversion">sysversion()</a> is cached (when the caller is root).</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The module also implements the <b>--info</b> command line option. This allows the invokation of <a href="#syssetup">syssetup()</a> to update or remove <b>_centauri_bash_lib</b>.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>This module may load some other modules on demand:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <a href="_centauri_bash_sys.html">_centauri_bash_sys</a>                           module loading runs ...
     └── <a href="#sysversion">sysversion()</a>                          ... by default</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <a href="#sysversion">sysversion()</a>                                 optional ...
     └── <a href="_centauri_bash_ins.html">_centauri_bash_ins</a></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <a href="#sysinfo">sysinfo()</a>
     └── <a href="#syssetup">syssetup()</a>                            optional ...
            ├── <a href="_centauri_bash_ins.html">_centauri_bash_ins</a>
            │       └── <a href="_centauri_bash_ext.html">_centauri_bash_ext</a>
            └── <a href="_centauri_bash_iom.html">_centauri_bash_iom</a>
                    └── <a href="_centauri_bash_ext.html">_centauri_bash_ext</a></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <a href="#sysconfig">sysconfig()</a>                                  depends ...
     └── <a href="_centauri_bash_run.html">_centauri_bash_run</a>
            └── <a href="_centauri_bash_iom.html">_centauri_bash_iom</a>
                    └── <a href="_centauri_bash_ext.html">_centauri_bash_ext</a></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <a href="#syssetup">syssetup()</a>
     └── <a href="_centauri_bash_ext.html">_centauri_bash_ext</a></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Copyright Dr. J. Pfennig (c) 2019-2022</div>
</div>
</section>
<section id='section-2'>
<div id='sysversion' class='item-function'>
<span>Function</span><span> - </span><span>sysversion</span><span> - </span><span>determine os/kde versions, read/write version file</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>sysversion</b> [<b>-k</b>] [<b>-o</b>] [<b>-r</b>|<b>-u</b>|<b>-w</b>]</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-k</b>  update kde version
<b>-m</b>  print version info
<b>-o</b>  update os version
<b>-r</b>  read state file (default, no updates)
<b>-u</b>  like read but update if needed
<b>-v</b>  generate trace messages
<b>-w</b>  write state file</div>
</div>
<div class='def-row'>
<div class='def-label'>Variables:</div>
<div class='def-text'>The function tries to obtain the following data:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <b>CEN_SYS_CONFIG</b>   -  distro config file/folder
  <b>CEN_SYS_DISTRO</b>   -  distribution name
  <b>CEN_SYS_FAMILY</b>   -  distribution family
  <b>CEN_SYS_NICKNAME</b> -  distribution nick name
  <b>CEN_SYS_ALIAS</b>    -  distribution alias
  <b>CEN_SYS_VERSION</b>  -  distribution version (sortable)</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <b>CEN_SYS_KDEVERS</b>  -  KDE main version (sortable)
  <b>CEN_SYS_PLASMA</b>   -  KDE plasma version (sortable)
  <b>CEN_SYS_QTVERS</b>   -  QT version (sortable)</div>
</div>
<div class='def-row'>
<div class='def-label'>Storage:</div>
<div class='def-text'><b>CEN_SYS_STATE_FILE</b>=<b>&quot;$CEN_SYS_STATE_DIR/centaurisystem&quot;</b></div>
</div>
<div class='def-row'>
<div class='def-label'>Default:</div>
<div class='def-block'>The following applies when <b>sysversion</b> is called without any option</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  • version information already loaded: return <b>true</b>
  • the caller is root: update persistent state as needed
  • non-root caller: try persistent state or locally cached state</div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>It is not possible to determine the KDE-Plasma version if KDE is not running. If so the function tries next time when running under KDE.</div>
</div>
</section>
<section id='section-3'>
<div id='syssetup' class='item-function'>
<span>Function</span><span> - </span><span>syssetup</span><span> - </span><span>Setup/remove folders and links and services</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>syssetup</b> [<b>-i</b>|<b>-p</b>|<b>-r</b>|<b>-u</b>] [<i>rootdef</i>|<b>-</b>]</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-i</b>  initialize         (sysinfo install)
<b>-n</b>  copy library files (sysinfo refresh)
<b>-p</b>  setup paths only
<b>-r</b>  remove, uninstall  (sysinfo uninstall)
<b>-s</b>
<b>-t</b>  check <b>CEN_ROOT</b> setup
<b>-u</b>  silent update      (sysinfo update)
    do not configure services, no questions</div>
</div>
<div class='def-row'>
<div class='def-label'>Rootdef:</div>
<div class='def-block'>A colon seperated list of paths, that can be used to override the <b>&quot;defaults shared&quot;</b> or <b>&quot;defaults private&quot;</b> config entries in section <b>[library]</b> of <b>centauri-bash-lib</b>:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>  <i>root</i><b>:</b><i>binaries</i><b>:</b><i>shortcut</i><b>:</b><i>repository</i><b>:</b><i>owner</i></div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Not all fields need to be specified, and <i>repository</i> is not interpreted by the library itself (might be used to specify a network location).</div>
</div>
<div class='def-row'>
<div class='def-label'>Setup:</div>
<div class='def-text'>The setup process has the following steps:</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-text'>(1) Setup $<b>CEN_ROOT</b> folders and links (automatic, implicit)
(2) Symlink tools to a bin folder like <b>&quot;/usr/local/bin&quot;</b>
(3) Symlink $<b>CEN_ROOT</b>/tools to a folder like <b>&quot;/opt/centauritools&quot;</b>
(4) Installing services (<b>SysV</b> or <b>systemd</b>)
(5) Generating the _centauri_bash_lib proxy (automatic)
(6) Registering for <b>bash</b> auto completion (automatic)</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The uninstall process reverts all setup steps.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>A shallow setup (step 1 only) is performed with option <b>-p</b> and is for use by tools that install the library from a repository. The tools will use option <b>-u</b> to run step 2 after updates from the repository.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The <b>syssetup</b> function can be invoked from every <b>centauritool</b> via command line option <b>--info</b>. See <a href="#sysinfo">sysinfo()</a> for details.</div>
</div>
</section>
<section id='section-4'>
<div id='sysinfo' class='item-function'>
<span>Function</span><span> - </span><span>sysinfo</span><span> - </span><span>implements --info to update or remove _centauri_bash_lib</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'>(1) <b>sysinfo</b> [<b>version</b>|<b>detailed</b>]
(2) <b>sysinfo</b> [<b>install</b>|<b>uninstall</b>|<b>update</b>] <i>root</i> [<b>noquit</b>]
(3) cd <i>repo</i>
    <b>sysinfo</b> <b>refresh</b>|<b>setup</b> <i>dest</i> [<b>noquit</b>]</div>
</div>
<div class='def-row'>
<div class='def-label'>General:</div>
<div class='def-block'>This is the implementation of command line option <b>--info</b>. The <b>sysinfo</b> function is invoked from option processsing in <a href="_centauri_bash_lib.html#main">main()</a>. It should not be used as an API, call <a href="#syssetup">syssetup()</a> instead.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>The argument following the <b>--info</b> option is interpreted as keyword to determine an action. Form (1) outputs various version information and terminates execution via quit(). Form (2) handles symlinking into system folders and (un)registering system services. Form (3) is used to copy all files from <i>repo</i> to <i>dest</i> (with <b>setup</b>) or to udate existing files (with <b>refresh</b>). See <a href="_centauri_bash_ins.html#installation">Installation</a> for more usage details.</div>
</div>
<div class='def-row'>
<div class='def-label'>Keywords:</div>
<div class='def-text'><b>detailed</b>      detailed version info, see <a href="_centauri_bash_use.html">_centauri_bash_use</a>
<b>install</b>       install centauri-bash-library globally
<b>refresh</b>       re-import library files from repository
<b>setup</b>         import library files from repository
<b>update</b>        update the installation
<b>uninstall</b>     uninstall centauri-bash-library
<b>version</b>       show/update OS and KDE versions</div>
</div>
<div class='def-row'>
<div class='def-label'>Arguments:</div>
<div class='def-text'><i>dest</i>          destination (later becoming <b>CEN_ROOT</b>)
<i>repo</i>          origin (probably the current <b>CEN_ROOT</b>)
<i>root</i>          override defaults, see <a href="#syssetup">syssetup</a></div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>Unless <b>noquit</b> is specified (form (2) and form (3) only), the function calls <a href="_centauri_bash_lib.html#quit">quit()</a> and never returns.</div>
</div>
</section>
<section id='section-5'>
<div id='sysconfig' class='item-function'>
<span>Function</span><span> - </span><span>sysconfig</span><span> - </span><span>read library config, generate bash_completion and proxy</span></div>
<div class='def-row'>
<div class='def-label'>Call:</div>
<div class='def-text'><b>sysconfig</b> [<b>-c</b>|<b>-p</b>]</div>
</div>
<div class='def-row'>
<div class='def-label'>Options:</div>
<div class='def-text'><b>-c</b>  generate bash completion
<b>-k</b>  keep <b>CEN_ROOT_DEF</b> unchanged
<b>-p</b>  generate proxy
<b>-s</b>  check if systemd is to be used
<b>-u</b>  update if neccessary</div>
</div>
<div class='def-row'>
<div class='def-label'>Remarks:</div>
<div class='def-block'>Reads <b>$CEN_ROOT/default/centauri_bash_lib</b> (for Debian this path is equal to <b>/etc/default/centauri_bash_lib</b>). If the file exists, it overrides the built-in default configuration.</div>
</div>
<div class='def-break'></div>
<div class='def-row'>
<div class='def-empty'></div>
<div class='def-block'>Optionally <b>_centauri_bash_completion</b> and the <b>_centauri_bash_lib</b> proxy can be generated.</div>
</div>
</section>
</article>
<div class='def-break'></div>
<nav><div class='nav-row'>
<div class='nav-left'><a href='_centauri_bash_svc.html'>[&lt;&lt; previous]</a></div>
<div class='nav-mid'><a href='#top'>[Top of Page]</a></div>
<div class='nav-mid'><a href='reference.html#top'>[Reference]</a></div>
<div class='nav-right'><a href='_centauri_bash_tra.html'>[next &gt;&gt;]</a></div>
</div></nav>
</body></html>
